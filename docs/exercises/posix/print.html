<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Exercises</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="act1/index.html"><strong aria-hidden="true">1.</strong> Activity 1</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="act1/ssh.html"><strong aria-hidden="true">1.1.</strong> Secure shell</a></li><li class="chapter-item expanded "><a href="act1/install.html"><strong aria-hidden="true">1.2.</strong> Installing vagrant and alpine linux</a></li><li class="chapter-item expanded "><a href="act1/admin.html"><strong aria-hidden="true">1.3.</strong> Alpine linux system administration</a></li><li class="chapter-item expanded "><a href="act1/git1.html"><strong aria-hidden="true">1.4.</strong> Git, part 1</a></li></ol></li><li class="chapter-item expanded "><a href="act2/index.html"><strong aria-hidden="true">2.</strong> Activity 2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="act2/git2.html"><strong aria-hidden="true">2.1.</strong> Git, part 2</a></li></ol></li><li class="chapter-item expanded "><a href="act3/index.html"><strong aria-hidden="true">3.</strong> Activity 3</a></li><li class="chapter-item expanded "><a href="act4/index.html"><strong aria-hidden="true">4.</strong> Activity 4</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="act4/c_io.html"><strong aria-hidden="true">4.1.</strong> Input/Output in C</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Exercises</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#activity-1" id="activity-1">Activity 1</a></h1>
<h2><a class="header" href="#videos" id="videos">Videos</a></h2>
<p>Before this activity, you should watch the following videos - most of them are quite short. The first link to each one links directly to an <code>.mp4</code> file that you can, for example, download and watch on your own machine. The second link takes you to the mediasite player which streams the video and provides optional captions, but you must be registered on the unit and logged in to blackboard to use the mediasite player link.</p>
<ul>
<li><a href="https://ams-hsta-ims-ond.mediasite.com/MediasiteDeliver/vol01/bristoluniversity/MP4Video/4bb49888-3284-4226-a6b5-fa0a0329db02.mp4/QualityLevels(698000)">shell video</a> 41 minutes (<a href="https://mediasite.bris.ac.uk/Mediasite/Play/165af898778b4b06a141ab6196124f8b1d">mediasite</a>)</li>
<li><a href="https://ams-hsta-ims-ond.mediasite.com/MediasiteDeliver/vol01/bristoluniversity/MP4Video/819aeecb-f5a6-47b9-9d22-306ade265b6b.mp4/QualityLevels(698000)">SSH video</a> 7 minutes (<a href="https://mediasite.bris.ac.uk/Mediasite/Play/e183094b765e45879ad085da62041ab51d">mediasite</a>)</li>
<li><a href="https://ams-hsta-ims-ond.mediasite.com/MediasiteDeliver/vol01/bristoluniversity/MP4Video/c771016a-8101-4236-b53a-dd2bb340eec3.mp4/QualityLevels(698000)">Vagrant video</a> 33 minutes (<a href="https://mediasite.bris.ac.uk/Mediasite/Play/82ae82e2e9324dbeb37bc4983a03d2941d">mediasite</a>)</li>
<li><a href="https://ams-hsta-ims-ond.mediasite.com/MediasiteDeliver/vol01/bristoluniversity/MP4Video/32f7121e-3bd3-4516-9de1-c8de4355fcf8.mp4/QualityLevels(698000)">Package managers video</a> 12 minutes (<a href="https://mediasite.bris.ac.uk/Mediasite/Play/e43dd6c0a3f94990bf712435f23310b31d">mediasite</a>)</li>
<li><a href="https://ams-hsta-ims-ond.mediasite.com/MediasiteDeliver/vol01/bristoluniversity/MP4Video/8703ab2e-f791-4ab0-bef6-262a91069b4c.mp4/QualityLevels(698000)">Git 1 video</a> 21 minutes (<a href="https://mediasite.bris.ac.uk/Mediasite/Play/c85056040c3b4f34b762901b1ad9360c1d">mediasite</a>)</li>
</ul>
<h2><a class="header" href="#exercises" id="exercises">Exercises</a></h2>
<ul>
<li><a href="act1/./ssh.html">Secure shell</a></li>
<li><a href="act1/./install.html">Installing vagrant and alpine linux</a></li>
<li><a href="act1/./admin.html">Alpine linux system administration</a></li>
<li><a href="act1/./git1.html">Git, part 1</a></li>
</ul>
<h1><a class="header" href="#secure-shell" id="secure-shell">Secure shell</a></h1>
<p>Secure shell (SSH) is a protocol to allow you to remotely log in to another computer, such as a lab machine. Everyone I know of who uses SSH uses the free OpenSSH implementation, which is standard on every linux distribution that I know of and is also available for Windows and Mac - and even for the mobile operating systems iOS and Android.</p>
<p>We will see in more detail how SSH manages connections later on, but for now imagine that it opens a network connection between your own machine, and a shell running on a different machine. When you type something, SSH encrypts this and sends it to the other machine which decrypts it and passes it to the shell (or any other program you're running); when the shell replies then SSH encrypts that and sends it back to you. For this to work, (Open)SSH is actually two programs:</p>
<ul>
<li><code>ssh</code> is the client, which you run on your machine to connect to another machine.</li>
<li><code>sshd</code> is the server, or <em>daemon</em> in UNIX-speak. It runs in the background on the machine you want to connect to, and needs to be installed by the system administrator.</li>
</ul>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>SSH uses TCP port 22 by default.</p>
</div>
</div>
<h2><a class="header" href="#check-your-client" id="check-your-client">Check your client</a></h2>
<p>First of all, let's check that the ssh client is working.</p>
<ul>
<li>Open a terminal on your own machine: linux, mac OS and windows subsystem for linux should be fine. Windows 10 CMD might work too if you have the windows version of openssh installed (for example if you have git installed which uses ssh behind the scenes).</li>
<li>Type <code>ssh localhost</code> and press ENTER. Several different things could happen:
<ul>
<li>If it asks for a password, then the ssh client is working, and a ssh server is running on your current machine. The password would be your user account password, but we don't actually want to log in again so cancel with Control+C.</li>
<li>If it succeeds without a password, then the client is working and a ssh server is running on your machine and either you do not have a password, or you already have a key set up. Type <code>exit</code> and press ENTER to get back to your previous shell.</li>
<li>If it shows &quot;connection refused&quot;, then you have the ssh client correctly working but no server running on your own machine. This is not a problem, as we're trying to log in to the lab machines, so we need a client on our machine and a server on the lab machine.</li>
<li>If it shows an error that ssh is not found, then you don't have (Open)SSH installed which is very unusual except on windows CMD - in which case please switch to using the windows subsystem for linux.</li>
</ul>
</li>
</ul>
<h2><a class="header" href="#connect-to-the-lab" id="connect-to-the-lab">Connect to the lab</a></h2>
<p>The lab machines have names <code>it######.wks.bris.ac.uk</code> where the hashes represent a number from 075637 up to 075912. However, not all of them will be working at any one time, if everyone connects to the same machine then it will quickly get overloaded, and for security reasons the lab machines are not directly accessible from the internet. Instead, we will use two other machines to connect:</p>
<ul>
<li>The bastion host <code>seis.bris.ac.uk</code>. This is reachable over SSH from the internet, and is on a university network that lets you connect further to the lab machines. You should not attempt to do any work on seis itself, as most of the software you would like to use (like compilers) is not installed there. However, you do have a home directory on seis for storing things like SSH keys.</li>
<li>The load balancer <code>rd-mvb-linuxlab.bristol.ac.uk</code>. This connects you to a lab machine that is currently running and ensures that if everyone uses this method to connect, then they will be more or less equally distributed among the running machines.</li>
</ul>
<p>Try the following:</p>
<ul>
<li>On your terminal, type <code>ssh USERNAME@seis.bris.ac.uk</code> where you replace USERNAME with your university username, e.g. <code>aa20123</code>. Obviously, you will need a working internet connection for this.</li>
<li>If it asks you whether you are sure, type <code>yes</code> and press ENTER. SSH will only do this the first time you connect to a machine that you have never used before.</li>
<li>When prompted, enter your university password and press ENTER.</li>
<li>You should now see the prompt on seis, which looks something like <code>-bash-4.2$</code>. Try the command <code>uname -a</code> to print information about the system (uname on its own prints the operating system name, <code>-a</code> shows &quot;all&quot; information). The reply line should start <code>Linux seis-shell</code>, which is the operating system and host name.</li>
<li>On the seis prompt, type <code>ssh rd-mvb-linuxlab.bristol.ac.uk</code>. This might take a few seconds; say yes if it asks you if you're sure, then enter your password again when prompted. We didn't have to give a username again because you are already logged in to seis with your university username (<code>whoami</code> shows this) and when you ssh without giving a username, it uses the one you are currently logged in as.</li>
<li>You should now be connected to a lab machine, with a prompt of the form <code>USERNAME@it######:~$</code>. </li>
<li>Try <code>whoami</code> and <code>uname -a</code> to check who you are logged in as, and where; also try <code>hostname</code> which just prints the machine name.</li>
<li>Type <code>exit</code> twice to get back to your own machine. (Once gets you back to seis, twice closes the ssh connection completely.)</li>
</ul>
<p>Connecting to one machine through another machine (in this case seis) as a proxy is such a common use case that ssh in fact has an option for it:</p>
<pre><code>ssh -J USERNAME@bristol.ac.uk USERNAME@rd-mvb-linuxlab.bristol.ac.uk
</code></pre>
<p>The <code>-J</code> for &quot;jump through this host&quot; even accepts a comma-separated list of hosts if you need to connect through more than one. However, you need to repeat your username for every machine.</p>
<p>You now know how to log in to a lab machine, but in both methods you had to type your password twice - let's make that easier. The answer is not to store your password in a file, but to use keys instead.</p>
<h2><a class="header" href="#setting-up-ssh-keys" id="setting-up-ssh-keys">Setting up ssh keys</a></h2>
<p>When you connect to a machine, the client on your computer and the daemon on the machine you're logging in to run a cryptographic protocol to exchange keys and set up a shared secret key for the session, so that what one side encrypts the other side can decrypt again. It also authenticates you to the server using one of several methods. </p>
<p>You might have heard from a security source that there are three main authentication factors: something you know (password or PIN), something you have (physical key, digital key, ID card, passport) and something you are (biometrics). An authentication method that requires two of these is called two-factor authentication and this is considered good security practice. For ssh, this means:</p>
<ul>
<li>You can log in with a username and password, that is &quot;something you know&quot;. This is the default, but not the most secure.</li>
<li>You can log in with a (digital) key, that is &quot;something you have&quot;. This is more secure, as long as your key (which is just a file) doesn't get into the wrong hands, and also the most convenient as you can log into a lab machine or copy files without having to type your password.</li>
<li>You can log in with a key file that is itself protected with a password. This gets you two-factor authentication.</li>
</ul>
<p>The keys that SSH uses implement digital signatures. Each key comes as a pair of files:</p>
<ul>
<li>A private key (also known as secret key) in a file normally named <code>id_CIPHER</code> where CIPHER is the cipher in use. You need to keep this secure and only store it in places that only you have access to.</li>
<li>A public key in a file normally named <code>id_CIPHER.pub</code>. You can share this with the world, and you will need to store a copy of it on any machine or with any service that you want to log in to (for the lab, because the lab machines all share a file system, you only need to store it once - but seis has a separate file system so you need a separate copy there).</li>
</ul>
<p>Let's create a key pair:</p>
<ul>
<li>Type the command <code>ssh-keygen -t ed25519</code>. (If you get an &quot;unknown key type&quot; error, then you are using an outdated version of OpenSSH and for security reasons you should upgrade immediately.)</li>
<li>When it asks you where to save the file, just press ENTER to accept the default, but make a not of the path - normally it's a folder <code>.ssh</code> in your home directory.</li>
<li>If it asks you &quot;Overwrite (y/n)&quot;, say no (n, then ENTER) as it means you already have a key for something else - either ssh directly or something that uses it, like github. Restart key generation but pick a different file name.</li>
<li>When it asks you for a password, I recommend that you just press ENTER which doesn't set a password (good security, maximum convenience). If you do set a password, it will ask you to type it twice and then you will need the password and the key file to use this key (maximum security, less convenient).</li>
</ul>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>The <code>-t</code> parameter selects the cryptographic algorithm to use, in this case <code>ed25519</code>, which is modern, peer-reviewed, and generally considered one of the most secure public-key algorithms available. However some older ssh versions don't accept ed25519.</p>
<p>If you ever need to use SSH keys to a machine that doesn't like ed25519, then use the key type &quot;rsa&quot; instead. I would personally avoid the alternatives &quot;dsa&quot; and &quot;ecdsa&quot; if at all possible as there is speculation among cryptographers that there may be a flaw in the design.</p>
<p>For example, although seis supports ed25519, the old cs bastion host <code>snowy.cs.bris.ac.uk</code> still uses an older version of SSH, so you would need to generate a rsa key to connect to that.</p>
</div>
</div>
<p>Have a look at the folder where your keys are stored. <code>ls -l ~/.ssh</code> will do this, unless you chose somewhere else to store them when you created them:</p>
<pre><code>-rw-------. 1 vagrant vagrant  411 Oct  7 10:50 id_ed25519
-rw-r--r--. 1 vagrant vagrant   98 Oct  7 10:50 id_ed25519.pub
-rw-r--r--. 1 vagrant vagrant 1597 Oct  7 11:54 known_hosts
</code></pre>
<p>Note the permissions on these files in my example. The private key (first line) has a permissions line at the start of <code>(-)(rw-)(---)(---)</code> where I've added brackets to make clearer what is going on. The first bracket only applies to special file types (e.g. <code>d</code> for directory). Next, the owner permissions which are in this case read and write (the third one would be <code>x</code> if the file were an executable program). The last two brackets are the permissions for the group and for everyone else, and these are all off so no-one except yourself (and root) can read your key file. OpenSSH is picky about this and will refuse to use a private key that other people have access to.</p>
<p>The public key permissionas are <code>(-)(rw-)(r--)(r--)</code> which means that the owner can read and write, and the group and everyone else (assuming they have access to the folder) can read the public key, which is fine. It's a public key after all.</p>
<p><code>known_hosts</code> is where SSH stores the public keys of computers you've already connected to: every time you answer yes to an &quot;Are you sure you want to connect?&quot; question when you connect to a new computer for the first time, it stores the result in this file and won't ask you again the next time. The file format is one key per line and you can edit the file yourself if you want to.</p>
<h2><a class="header" href="#set-up-key-access-on-seis" id="set-up-key-access-on-seis">Set up key access on seis</a></h2>
<p>First, we need to upload our public key to seis. The command for this is <code>scp</code> for secure copy, which works like <code>cp</code> but allows you to include remote hosts and does the copy over SSH:</p>
<pre><code>scp ~/.ssh/id_ed25519.pub &quot;USERNAME@seis.bris.ac.uk:~/.ssh&quot;
</code></pre>
<p>Obviously, replace USERNAME with your university username. This will ask for your password again. Note two things here: first, to set up access on seis, we are uploading the public key - not the private key! - and secondly, that we put double quotes around the destination. This is because the <code>~</code> character meaning home directory is handled by our shell, but we don't want our local shell to expand it, instead we want the shell on seis launched by scp to expand it to our home directory on that machine.</p>
<p>The general syntax of scp is <code>scp source destination</code> and source or destination  may be of the form <code>[USERNAME@]HOSTNAME:PATH</code> - if it contains a colon (<code>:</code>), then it refers to a file on a different machine.</p>
<p>Now log in to seis over ssh and type your password one last time. Then run the following:</p>
<pre><code>cd .ssh
cat id_ed25519.pub &gt;&gt; authorized_keys
chmod 600 authorized_keys
</code></pre>
<p>SSH will accept a public key if it is listed in the file <code>authorized_keys</code> in the user's <code>.ssh</code> folder, the format is one line per key. Instead of just copying <code>id_ed25519.pub</code> to <code>authorized_keys</code>, which would overwrite the latter file if it already existed, we use the construction <code>cat SOURCE &gt;&gt; DEST</code> to have our shell append the source file to the destination.</p>
<p>However, if the authorised keys file didn't exist already, then it has now been created with default permissions and SSH won't accept that for security reasons. <code>chmod</code> means change permissions (also known as &quot;mod bits&quot;) and 600 is the bit pattern we want in base 8, because that is how permissions work for historical reasons. Permissions are a bitfield of 9 bits, the first three are read/write/execute for the owner, the next three the same for the group, and then for everyone else. If you <code>ls -l</code> you will see this in a slightly more human-readable format, namely <code>rw-------</code> where a minus means that a bit is turned off.</p>
<p>Now type <code>exit</code> to get back to your own machine, and then <code>ssh USERNAME@seis.bris.ac.uk</code> to log back in to seis. It should log you in without asking for a password, and you have now set up key-based SSH authentication for seis.</p>
<p>Note: if you set a password on your SSH key earlier, then it will ask you for a password, and it will expect the key password not your uni password. You know not to ever reuse your uni password for anything else, right?</p>
<p>If for some reason something doesn't work with ssh, the first thing to try is to add the <code>-v</code> switch enable debugging information (you can even do <code>-vv</code> or <code>-vvv</code> to see even more detail, but we don't need that). If there is a problem with the permissions on your private key file for example, then you will see SSH complain in the debugging information.</p>
<h2><a class="header" href="#setting-up-keys-for-lab-machines" id="setting-up-keys-for-lab-machines">Setting up keys for lab machines</a></h2>
<p>You can now get into seis with a key, but you want to be on a lab machine to get work done.</p>
<p>To connect from your machine to seis, you need a private key on your machine and a public key on seis. To connect from seis to a lab machine, it would seem like you need a public key on the lab machine and a private key on seis. You do not want to upload your private key to seis though for security reasons, so instead we are going to use a SSH feature called <em>agent forwarding</em> which means that if you SSH into one machine, then when you try and SSH further into another machine SSH will reuse the same key. The way to do this is to use the <code>-A</code> command line flag.</p>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>The point of key-based authentication is that your private key never leaves your own machine, so even university administrators never get to see it, which would not be guaranteed if you stored a copy on a university machine.</p>
<p>Logging in to a machine does not send the key to that machine. Instead, the machine sends you a challenge - a long random number - and SSH digitally signs that with the private key on your own machine, and sends the signature back which the remote machine can verify with the public key. Seeing a signature like this does not let the machine create further signatures on your behalf, and it definitely does not reveal the key.</p>
<p>What agent forwarding does is it allows challenges and signatures to be forwarded across multiple connections, but the key never leaves your own machine.</p>
<p>This way, you can create one SSH key and use it for university, github and anything else that you access over SSH, and even if one service is breached then this does not give the attacker access to your accounts on the other services.</p>
</div>
</div>
<ul>
<li>Log in to seis with <code>ssh USERNAME@seis.bris.ac.uk</code>. You should not need a password anymore.</li>
<li>Copy your public key file to the lab machines with <code>scp ~/.ssh/id_ed25519.pub &quot;rd-mvb-linuxlab.bristol.ac.uk:~/.ssh&quot;</code>. </li>
</ul>
<p>This step is necessary because your home directory on seis is not the same as on the lab machines. Note the double quotes again, and because you run this command on seis you don't need to repeat your username as it is the same for both machines involved. This command will ask for your password.</p>
<ul>
<li>Log in to a lab machine with <code>ssh rd-mvb-linuxlab.bristol.ac.uk</code> and enter your password one last time. On the lab machine, install the public key with the following:</li>
</ul>
<pre><code>cd .ssh
cat id_ed25519.pub &gt;&gt; authorized_keys
chmod 600 authorized_keys
</code></pre>
<p>Everything should be set up now: do <code>exit</code> twice to get back to your own machine, and try logging in to a lab machine with</p>
<pre><code>ssh -A -J USERNAME@seis.bris.ac.uk USERNAME@rd-mvb-linuxlab.bristol.ac.uk
</code></pre>
<p>This should now work directly, and without passwords.</p>
<h2><a class="header" href="#setting-up-a-configuration-file" id="setting-up-a-configuration-file">Setting up a configuration file</a></h2>
<p>You now have a log in command that works, but you still have to type a lot, and you need to type your username twice. We can improve this by using a configuration file.</p>
<p>SSH reads two configuration files: one for all users at <code>/etc/ssh/ssh_config</code> (<code>/etc</code> is where POSIX programs typically store global settings) and a per-user one at <code>~/.ssh/config</code>. The site <a href="https://www.ssh.com/ssh/config/">https://www.ssh.com/ssh/config/</a> or just <code>man ssh_config | less</code> on a terminal contain the documentation (<code>man</code> means manual page, and <code>less</code> is a program that shows a file on page at a time and lets you scroll and search).</p>
<p>Create a file called simply <code>config</code> in your <code>.ssh</code> directory on your own machine. You can do this for example with <code>touch config</code>, and then editing it in your favourite text editor. Add the following lines, replacing USERNAME with your username twice:</p>
<pre><code>Host seis
  HostName seis.bris.ac.uk
  User USERNAME

Host lab
  HostName rd-mvb-linuxlab.bristol.ac.uk
  ProxyJump seis
  User USERNAME
</code></pre>
<p>This now lets you use simply <code>ssh lab</code> to log in to a lab machine via seis (agent forwarding is implied when you use <code>ProxyJump</code>), or <code>ssh seis</code> if you want to access seis directly for example to update your keys there.</p>
<ul>
<li>Try <code>ssh lab</code> from your own machine. This will be your main way to log in to a lab machine from now onwards.</li>
</ul>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>If you want to learn another useful skill as you go along, here is one way to edit files on the command line. Many linux distributions have an editor called <code>nano</code> built in which runs in the terminal, so <code>nano config</code> edits the file called config (creating it if it doesn't exist, when you save for the first time). It is fairly self-explanatory, the command Control+X quits as you can see on the command bar at the bottom of the screen in nano and if you quit with unsaved changes, it will ask you if you want to save.</p>
<p>Nano is installed on seis and on the lab machines, so you can use it to edit a file remotely.</p>
<p>However, nano is not installed by default on alpine linux which we will be using for a lot of this unit - you can install it yourself with <code>sudo apk add nano</code>. </p>
</div>
</div>
<h2><a class="header" href="#using-different-keys" id="using-different-keys">Using different keys</a></h2>
<p>You do not need this for the lab, but if you are ever managing different systems and accounts then you might use a different key file for each one. In this case, ssh on the command line lets you do <code>-i FILENAME</code> to select a private key file, and in the configuration file you can select a file for a particular host with the <code>IdentityFile FILENAME</code> line. By default, ssh will search for files in <code>.ssh</code> with names <code>id_CIPHER</code>, as you can see if you launch a connection with the <code>-vv</code> parameter which shows detailed debugging information.</p>
<h1><a class="header" href="#installing-vagrant-and-alpine-linux" id="installing-vagrant-and-alpine-linux">Installing vagrant and alpine linux</a></h1>
<p><a href="https://www.vagrantup.com/">Vagrant</a> is a program to manage virtual machines (VMs). Based on a configuration file called a <code>Vagrantfile</code>, it can download and configure disk images, which it calles boxes, and call other programs to run them. Vagrant does not run the VM by itself, so you will need another program like <a href="https://www.virtualbox.org/">virtualbox</a> for that.</p>
<h2><a class="header" href="#installing-on-your-own-machine" id="installing-on-your-own-machine">Installing on your own machine</a></h2>
<p>To use vagrant on your own machine (recommended), follow these steps:</p>
<ul>
<li>Go to <a href="https://www.vagrantup.com/downloads">https://www.vagrantup.com/downloads</a> and download the version of vagrant for your operating system. Windows, Mac OS and common versions of linux are supported.</li>
<li>Download and install virtualbox from <a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a>.</li>
<li>Reboot your machine.</li>
</ul>
<p>If you are on linux, you can of course also install the programs from your distribution's repository. Vagrant's developers actually recommend against this because they claim that some distributions package outdated versions, but it is your choice.</p>
<h2><a class="header" href="#configuring-a-box" id="configuring-a-box">Configuring a box</a></h2>
<p>Next, you are going to configure a virtual machine using <a href="https://www.alpinelinux.org/">alpine linux</a>, a minimal linux distribution that we will be using in this unit. </p>
<ul>
<li>Create an empty folder somewhere.</li>
<li>In that folder, create a file called Vagrantfile (capitalised, and with no extension) and add the following lines to it - or just download the file from <a href="act1/../resources/Vagrantfile">here</a>:</li>
</ul>
<pre><code class="language-ruby">Vagrant.configure(&quot;2&quot;) do |config|
  config.vm.box = &quot;generic/alpine310&quot;
  config.vm.synced_folder &quot;.&quot;, &quot;/vagrant&quot;

  config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL
    apk add libc6-compat util-linux
  SHELL
  config.vm.provision :shell, run: 'always', inline: &lt;&lt;-SHELL
	umount /vagrant
	/sbin/mount.vboxsf -o uid=1000 -o gid=1000 vagrant /vagrant
	chmod go+rx /vagrant
  SHELL
end
</code></pre>
<p>This configuration file is actually a script in the ruby programming language, but you don't need to learn that to use vagrant. Let's look at what it does.</p>
<ul>
<li><code>config.vm.box</code> selects the virtual machine image, or box in vagrant-speak, to use. You can see a list of available ones at https://app.vagrantup.com/boxes/search.</li>
<li><code>config.vm.synced_folder</code> sets up a shared folder between the guest (virtual machine) and host (your machine).</li>
<li>The first <code>config.vm.provision</code> runs a provisioning command when the box is first downloaded and installed. These commands run as root on the virtual machine, and in this case we are using the <code>apk</code> package manager (we will talk about this later on) to install two packages <code>libc6-compat</code> and <code>util-linux</code>.</li>
<li>The second <code>config.vm.provision</code> is tagged with <code>run: 'always'</code> so it runs every time the virtual machine starts. It turns out there is a bug in how shared folders work that means alpine linux and virtualbox don't get a long; the three lines of commands after that get the shared folder working correctly again. We will learn what they do later on.</li>
<li>The <code>&lt;&lt;-SHELL</code> construction is called a &quot;here document&quot;, and is a way in some programming languages of writing multi-line strings. It tells ruby to treat everything until the closing keyword SHELL (which is arbitrary) as a string, which can contain several lines.</li>
</ul>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>Alpine linux uses the musl libc distribution, which is smaller than and has a few distinct differences from the normal GNU libc. To avoid these incompatibilities causing you hard-to-find problems when you are compiling C programs, we are installing <code>libc6-compat</code> that makes alpine compatible with the standard libc. <code>util-linux</code> contains a few standard linux command line tools that are not installed by default on alpine - it really is that minimal.</p>
</div>
</div>
<h2><a class="header" href="#running-vagrant" id="running-vagrant">Running vagrant</a></h2>
<ul>
<li>Open a terminal in the folder containing the Vagrantfile. If you are on windows, both the windows CMD and the windows subsystem for linux terminal will work equally well for this purpose.</li>
<li>Run the command <code>vagrant up</code>. This starts the virtual machine configured in the current folder, and if it has not been downloaded and provisioned yet (as is the case when you run <code>up</code> for the first time) then it does this for you as well.</li>
<li>When vagrant tells you the machine is running, run <code>vagrant ssh</code> to log in to your virtual machine. If it asks you for a password, use <code>vagrant</code>.</li>
<li>You should now see the virtual machine prompt <code>alpine310:~$</code>. Try the command <code>ls /</code> and check that there is a folder called vagrant in the top-level folder, along with system ones with names like <code>usr</code> and <code>bin</code>.</li>
</ul>
<p>There are two kinds of errors you might get during <code>vagrant up</code>:</p>
<ul>
<li>If vagrant complains that it can't find a provider, then you have probably not installed virtualbox, or not rebooted since installing it.</li>
<li>If you get some odd crash or error message about hypervisors, see the page <a href="https://www.vagrantup.com/docs/installation">https://www.vagrantup.com/docs/installation</a> for instructions, section <em>Running Multiple Hypervisors</em>. Basically, you cannot run vagrant when another program is already using your processor's virtualisation subsystem, and the page gives instructions how to turn off the other one.</li>
</ul>
<h2><a class="header" href="#shutting-down-cleanly" id="shutting-down-cleanly">Shutting down cleanly</a></h2>
<p>To exit the virtual machine, type <code>exit</code> which will get you back to the shell on the host machine. On the host, <code>vagrant halt</code> cleanly shuts down the virtual machine.</p>
<p>Promise yourself that you will always do this before turning off your computer, if you have been using vagrant!</p>
<h2><a class="header" href="#running-on-a-lab-machine" id="running-on-a-lab-machine">Running on a lab machine</a></h2>
<p>Vagrant is already installed on the lab machines in MVB 2.11, so you can remotely log in and launch a box from there. This will get you exactly the same alpine environment as if you run on your own machine, and everyone should try this out too. If for some reason you cannot run vagrant on your machine, then as long as you have an internet connection you should still be able to run it on the lab machines.</p>
<p>First, we connect to a lab machine: open a terminal and run the command <code>ssh lab</code> that you configured in the previous section on SSH.</p>
<p>On the lab machine, we need to create a folder and load a Vagrantfile as above, but let's download the Vagrantfile from the unit webpage instead of typing it out. Run the following shell commands:</p>
<pre><code class="language-sh">mkdir softwaretools
cd softwaretools
wget https://raw.githubusercontent.com/cs-uob/COMS10012/master/resources/week1/Vagrantfile
</code></pre>
<p>You can call the top folder (softwaretools) anything you like and put it anywhere you want. You can now run <code>vagrant up</code> followed by <code>vagrant ssh</code> from inside that folder.</p>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>When you <code>vagrant up</code>, vagrant internally connects port 22 on the guest (which <code>sshd</code> on the guest is listening to) to port 2222 on the host. When you provision a vagrant machine, this creates a key pair on the host and loads the public key into the guest. The private key is actually in the file <code>.vagrant/machines/default/virtualbox/private_key</code> on the host, and the public key in <code>/home/vagrant/.ssh/authorized_keys</code> on the guest. So what <code>vagrant ssh</code> does is launch <code>ssh -i KEYFILE vagrant@localhost -p 2222</code>.</p>
</div>
</div>
<h2><a class="header" href="#warning-about-lab-machines---read-carefully" id="warning-about-lab-machines---read-carefully">Warning about lab machines - read carefully!</a></h2>
<p>Your files in your home directory on a lab machine are stored in a network folder, so that you see the same files whichever lab machine you log in to; they are also automatically backed up.</p>
<p>If lots of students created lots of VMs in their home folders, this would take up lots of space, and it would be slow: running an operating system over a network share causes both bandwidth and latency problems.</p>
<p>Instead, IT has configured vagrant on the lab machines to store VMs in the <code>/tmp</code> folder which is local to each machine. This means that:</p>
<ul>
<li>If you log in to a different lab machine, your VMs will be gone.</li>
<li>If you log in to the same lab machine but it has restarted since you last logged in, your VMs will be gone.</li>
<li>Your VMs, and with them any files you store in the VM itself, are not backed up.</li>
</ul>
<p>This is not as much a problem as it seems because this is how virtual machines are meant to work: if one is not available, vagrant downloads and provisions it. For this reason, for any software you want installed on your VMs in the lab machines, you should write the install command into the provisioning script in the Vagrantfile so it will be re-installed the next time Vagrant has to set up the VM. We will learn how to do this soon.</p>
<p>However, this still leaves files that you create on the VM itself, such as the ones you will create for the exercises in this unit. The basic warning is that <em>any files in your home directory will be lost when the VM is rebuilt</em>. That is why we have set up a shared folder which you can access as <code>/vagrant</code> on the VM, which maps to the folder containing your Vagrantfile on the host machine. Because this is stored under your home folder on the lab machine, it lives on the network file store and so it is backed up and available from all lab machines.</p>
<p>So whenever you log in to a VM on a lab machine to do some work, you should <code>cd /vagrant</code> and use that instead of your home folder for any files that you don't want to lose. If you are running vagrant on your own computer, then nothing will be deleted except if you give vagrant a command to rebuild the VM yourself.</p>
<h1><a class="header" href="#alpine-linux-system-administration" id="alpine-linux-system-administration">Alpine linux system administration</a></h1>
<p>Log in to your alpine linux box (<code>vagrant ssh</code>). We are going to get to know linux in general and alpine in particular a bit.</p>
<h2><a class="header" href="#the-file-system" id="the-file-system">The file system</a></h2>
<p>Linux (and other POSIX-like operating systems) work with a single file hierarchy with a root folder <code>/</code>, although there may be different file systems mounted at different places under that. How files are organised in here are documented in the <a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html">Filesystem Hierarchy Standard (FHS)</a>. Have a look with the command <code>ls /</code>:</p>
<p><code>/bin</code> stands for binaries, that is programs that you can run. Have a look with <code>ls /bin</code>: there will be a lot of commands in here, including ls itself. Indeed you can find out where a program is with <code>which</code>, so <code>which ls</code> will show you <code>/bin/ls</code> for example.</p>
<p>If you have colours turned on (which is the default) you will see that a couple of files like <code>bash</code> are green, but the rest are blue - this indicates the file type, green is an executable program, blue is a link to another file. Have a look with <code>ls -l /bin</code>: the very first character of each line indicates the file type, the main ones being <code>-</code> for normal file, <code>d</code> for directory and <code>l</code> for a so-called <em>soft link</em>.</p>
<p>Note that, as you can see on the last entry of each line, most files here are links to <code>/bin/busybox</code>! Busybox is, in its own words:</p>
<blockquote>
<p>BusyBox is a multi-call binary that combines many common Unix
utilities into a single executable.  Most people will create a
link to busybox for each function they wish to use and BusyBox
will act like whatever it was invoked as.
(from <code>busybox --help</code>)</p>
</blockquote>
<p>Busybox is a distribution of the many common POSIX commands (you can see which ones with <code>busybox --help</code>) packed into a single program. This means that you can run for example <code>busybox ls</code> to run the ls command. However, when you call <code>ls</code> directly, your shell runs the <code>/bin/ls</code> command, which is just a link to busybox. How does it know which command you want?</p>
<p>Remember that in C, each program's main function can take an argument vector <code>char **argv</code> and that <code>argv[0]</code> is the name of the file that was used to call the program - this is what busybox looks at when you call <code>ls</code> or any of the other linked programs in <code>/bin</code>.</p>
<p>Busybox is used in alpine linux because alpine is a minimal linux distribution and busybox is a minimal implementation of lots of common commands. As a result, the alpine/busybox version of say ls might not have as many options as the ls on the lab machines.</p>
<p>Back to <code>ls /</code> and the folders in the root folder. <code>/etc</code> stores system-wide configuration files and typically only root (the administrator account) can change things in here. For example, system-wide ssh configuration lives in <code>/etc/ssh</code>.</p>
<p><code>/lib</code> contains dynamic libraries - windows calls these <code>.dll</code> files, POSIX uses <code>.so</code>. For example, <code>/lib/libc.so.6</code> is the C library, which allows C programs to use functions like <code>printf</code>. You can see with <code>ls -l /lib</code> that the C library is actually a link to <code>/lib/libc.musl-x86_64.so.1</code>: <a href="https://musl.libc.org/">musl</a> is a minimal implementation of the C library, which is the version that alpine linux chose to use by default. From their website:</p>
<blockquote>
<p>musl is an implementation of the C standard library built on top of the Linux system call API, including interfaces defined in the base language standard, POSIX, and widely agreed-upon extensions. musl is lightweight, fast, simple, free, and strives to be correct in the sense of standards-conformance and safety.</p>
</blockquote>
<p><code>/home</code> is the folder containing users' home directories, for example the default user vagrant gets <code>/home/vagrant</code>. The exception is root, the administrator account, who gets <code>/root</code>.</p>
<p><code>/sbin</code> (system binaries) is another collection of programs, typically ones that only system administrators will use. For example, <code>fdisk</code> creates or deletes partitions on a disk and lots of programs with <code>fs</code> in their name deal with managing file systems. <code>/sbin/halt</code>, run as root (or another user that you have allowed to do this), shuts down the system; there is also <code>/sbin/reboot</code>.</p>
<p><code>/usr</code> is a historical accident and a bit of a mess. A short history is on <a href="https://askubuntu.com/questions/130186/what-is-the-rationale-for-the-usr-directory">this stackexchange question</a> but essentially, in the earliest days,</p>
<ul>
<li><code>/bin</code> was only for binaries needed to start the system - or at least the most important binaries that needed to live on the faster of several disk drives, like your shell.</li>
<li><code>/usr/bin</code> was where most binaries lived which were available globally, for example across all machines in an organisation.</li>
<li><code>/usr/local/bin</code> was for binaries installed by a local administrator, for example for a department within an organisation.</li>
</ul>
<p>In any case, <code>/usr</code> and its subfolders are for normally read-only data, such as programs and configuration files but not temporary data or log files. It contains subfolders like <code>/usr/bin</code> or <code>/usr/lib</code> that duplicate folders in the root directory.</p>
<p>Ubuntu's way of cleaning this mess up is to make its <code>/bin</code> just a link to <code>/usr/bin</code> and putting everything in there. On alpine linux, there is still a distinction between the two, but most binaries in both folders are links to <code>/bin/busybox</code> anyway. For example, if you do <code>which ls</code> you find <code>/bin/ls</code>, but <code>which which</code> shows <code>/usr/bin/which</code>, but both of these are in fact just links to <code>/bin/busybox</code>.</p>
<p><code>/tmp</code> is a temporary filesystem that may be stored in RAM instead of on disk (but swapped out if necessary), and that does not have to survive rebooting the machine.</p>
<p><code>/var</code> holds files that vary over time, such as logs or caches.</p>
<p><code>/dev</code>, <code>/sys</code> and <code>/proc</code> are virtual file systems. One of the UNIX design principles is that almost every interaction with the operating system should look to a program like reading and writing a file, or in short <em>everything is a file</em>. For example, <code>/dev</code> offers an interface to devices such as hard disks (<code>/dev/sda</code> is the first SCSI disk in the system, and <code>/dev/sda1</code> the first partition on that), memory (<code>/dev/mem</code>), and a number of pseudoterminals or ttys that we will talk about later. <code>/proc</code> provides access to running processes; <code>/sys</code> provides access to system functions. For example, on some laptop systems, writing to <code>/sys/class/backlight/acpi_video0/brightness</code> changes the screen brightness.</p>
<p>The <code>/vagrant</code> folder is not part of the FHS, but is a convention for a shared folder with the host on vagrant virtual machines.</p>
<h2><a class="header" href="#package-managers" id="package-managers">Package managers</a></h2>
<p>Linux has had package managers and repositories since the days when it was distributed on floppy disks. A repository is a collection of software that you can install, and can be hosted anywhere - floppy disk, CD-ROM, DVD or nowadays on the internet. A package manager is software that installs packages from a repository - so far, this sounds just like an <em>app store</em> but a package manager can do more. For one thing, you can ask to install different versions of a particular package if you need to. But the main point of a package manager is that packages can have dependencies on other packages, and when you install one then it installs the dependencies automatically.</p>
<p>Nano is a basic text editor that works in the console, and is installed in most linux distributions including the ones on seis and the lab machines, so you can use it to edit files remotely. However, in alpine linux it is not installed by default: type <code>nano</code> and you get <code>nano: command not found</code>. You can install it with the command</p>
<pre><code>sudo apk add nano
</code></pre>
<ul>
<li><code>sudo</code> (superuser do) allows you to run a command as root, also known as the administrator or superuser. Depending on how your system is configured, this might be not allowed at all (you can't do it on the lab machines), or require a password, but on the alpine/vagrant distribution you are allowed to do this. It is good practice to use sudo for system adminstration instead of logging in as root directly, but if you ever really need a root shell then <code>sudo bash</code> gets you one - with <code>#</code> instead of <code>$</code> as prompt to warn you that you are working as root.</li>
<li><code>apk</code> is the alpine linux package manager.</li>
<li><code>add PACKAGE</code> adds a package, which means download and install it and all its dependencies (nano is so small that it has none).</li>
</ul>
<p>You can now do <code>nano FILENAME</code> to edit a file. The keyboard shortcuts are at the bottom of the screen, the main one you need is Control+X to exit (it will ask if you want to save, if you have unasved changes).</p>
<p>Next, install git with <code>sudo apk add git</code>. Git requires two dependencies (apart from the ones already installed on the base system), as you can see in the output:</p>
<pre><code>(1/3) Installing expat (2.2.8-r0)
(2/3) Installing pcre2 (10.33-r0)
(3/3) Installing git (2.22.4-r0)
</code></pre>
<p><code>expat</code> is an XML parser (for configuration files) and <code>pcre2</code> implements perl-compatible regular expressions for searching for text.</p>
<p>We can use apk to explore this further, try the following:</p>
<ul>
<li><code>apk info git</code> shows information about the git package, including a short description and the website.</li>
<li><code>apk info -a git</code> shows more information, including the dependencies (section &quot;depends on&quot;, there are 5 listed but two are already part of the base system, <code>libc.musl</code> is the C library and <code>libz</code> is a compression library similar to &quot;zip&quot;) and a list of all files installed by the package.</li>
</ul>
<p>Note how git is built out of a number of subcommands in <code>/usr/libexec</code>. For example, when you do <code>git branch</code>, that ends up calling <code>/usr/libexec/git-core/git-branch</code>.</p>
<p>The commands above did not require <code>sudo</code> as they do not change any files on the system.</p>
<h2><a class="header" href="#update-and-upgrade" id="update-and-upgrade">Update and upgrade</a></h2>
<p>The repositories that you are using are recorded in <code>/etc/apk/repositories</code>, have a look at this file with <code>cat</code> or <code>nano</code> to see where they are, then look up the sites in your browser. There are folders for different processor architectures (the one in use is stored in <code>/etc/apk/arch</code>) and these contain all the packages as well as a file <code>APKINDEX.tar.gz</code> that contains a list of all packages and versions.</p>
<p>Two commands a system adminstrator should run regularly for security reasons:</p>
<ul>
<li><code>sudo apk update</code> fetches the new package list from the repository. This way, apk can tell you if any packages have been updated to new versions since you last checked.</li>
<li><code>sudo apk upgrade</code> upgrades every package that you already have installed to the latest version in your local package list (downloaded when you do an <code>apk update</code>).</li>
</ul>
<h2><a class="header" href="#lab-machines" id="lab-machines">Lab machines</a></h2>
<p>If you are running a virtual machine on the lab machines, then your virtual machine might not be around after the lab machine reboots or you log out and in again and end up on a different machine - as the notice when you log in tells you, the virtual machines are stored under <code>/tmp</code>.</p>
<p>It would be annoying to have to reinstall your favourite packages every time you log in to a different machine, so you should put them in your Vagrantfile and then <code>vagrant up</code> will do this for you automatically. The Vagrantfile already contains a line <code>apk add libc6-compat util-linux</code> which installs two packages by default - you can put as many as you like on this line separated by spaces. There is no <code>sudo</code> here because when vagrant is installing the system, it is running as root automatically.</p>
<ul>
<li>Add <code>nano</code> and <code>git</code> to this line so next time you rebuild the vagrant machine, they are added automatically.</li>
<li>Log out of your vagrant machine and do a <code>vagrant destroy</code> which removes the virtual machine. Then reload with <code>vagrant up</code> which will download and provision the box again.</li>
<li>Log in with <code>vagrant ssh</code> and check that git and nano are installed.</li>
</ul>
<p>For the next exercise, please also install the <code>gcc</code> package that gets you a C compiler, as well as <code>musl-dev</code> which contains header files like <code>stdio.h</code>. These, in case you wondered, live in <code>/usr/include</code>.</p>
<h1><a class="header" href="#git-part-1" id="git-part-1">Git, part 1</a></h1>
<p>For this exercise, I am assuming that you are working on alpine linux and have nano, git and gcc with musl-dev installed as in the last exercise.</p>
<h2><a class="header" href="#configuring-your-identity" id="configuring-your-identity">Configuring your identity</a></h2>
<p>Run the following two lines to set up git correctly. You only need to do this once when you install git, but not every time you create a new repository.</p>
<pre><code>git config --global user.name &quot;YOURNAME&quot;
git config --global user.email &quot;YOUREMAIL&quot;
</code></pre>
<p>where you obviously replace your name and email with something of your choice; I've put them in double quotes because this lets you include a space between your first and last names and the @ character in your email address.</p>
<p>This does not create a user account - git just uses your name and email to record the author in any commits you make, so you can put anything you like here (git will happily accept <code>-</code> as your email address, and it does not send you email). Of course, once you are working in a team with other students, you will probably want to use your real name so they know who has made which commits.</p>
<p>If you are running a VM on a lab machine, then you would need to reconfigure git every time vagrant rebuilds the VM, for example when you log in to a different lab machine. You can put these commands in your Vagrantfile, like anything else that you want to run when vagrant (re)builds your box, but they need to be run as the vagrant user and not the root user. So add the following block to your vagrantfile just before the <code>end</code> line, editing your name and email address obviously; the key point being the <code>privileged: false</code> entry which runs the commands as the <code>vagrant</code> user:</p>
<pre><code>config.vm.provision :shell, privileged: false, inline: &lt;&lt;-SHELL
    git config --global user.name &quot;YOURNAME&quot;
    git config --global user.email &quot;YOUREMAIL&quot;
SHELL
</code></pre>
<p>Of course this will only work if git is installed, but you've added git to the <code>apk add</code> line in the previous provision block already so it will be installed.</p>
<h2><a class="header" href="#a-sample-project-and-repository" id="a-sample-project-and-repository">A sample project and repository</a></h2>
<p>Let's say you want to start developing a C program. Let's make a folder:</p>
<pre><code>mkdir project1
cd project1
git init
</code></pre>
<p>The last command created an empty git repository in a subfolder called <code>.git</code>. We can check with <code>git status</code> to see whether there are any changes, and git reports <code>nothing to commit</code>.</p>
<p>Create a file, for example with <code>nano main.c</code> and add some sample content like this (you should be able to copy-paste into your terminal):</p>
<pre><code class="language-C">// file: main.c
#include &lt;stdio.h&gt;

int main() {
    puts(&quot;Hi&quot;);
    return 0;
}
</code></pre>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>If you install the <code>nano-syntax</code> package, you get syntax highlighting in nano, but you need to configure this first. The syntax files themselves live in <code>/usr/share/nano</code>, for example <code>c.nanorc</code> for the C language, but you have to include the ones you want in a file <code>~/.nanorc</code>. For example, if this file contains the line <code>include /usr/share/nano/c.nanorc</code> then nano will do syntax highlighting on C files. You can turn this on and off with Alt+Y.</p>
<p>On another note - if you just want to print a simple string in C, then please use puts not printf. Printf with one argument is silly and, depending on how you write it, also insecure.</p>
</div>
</div>
<p>Do a <code>git status</code> and you will see <code>main.c</code> in red under <em>untracked files</em> - this is a new file that git does not know about yet. Do <code>git add main.c</code> followed by another <code>git status</code> and the file is now gren under <em>files to be committed</em>.</p>
<p>Commit the file with <code>git commit -m &quot;first file&quot;</code> or something like that - you need double quotes if you want spaces in your commit message. Try <code>git status</code> again and you should see <em>nothing to commit, working tree clean</em> which means git is up to date with your files. Try <code>git log</code> and you will see that there is now one commit in the log.</p>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>Every git commit must have a commit message. You can either add one with the <code>-m</code> flag, or leave that off and git will drop you into the system default editor to write one. That is normally vi, which has a unique set of keyboard commands (the command to quit is <code>:q</code> followed by ENTER). You can run the shell command <code>export EDITOR=nano</code> to change your default editor, then a raw <code>git commit</code> will launch nano. If you want to keep this setting when you relaunch your shell next time you log in, then the export line has to go in a file called <code>.bashrc</code> in your home directory, which is a file that the bash shell processes when it starts up.</p>
<p>To keep a bashrc file around when vagrant rebuilds your VM if you're on a lab machine, I would put the file in <code>/vagrant/.bashrc</code> as that is backed up (it ends up in the folder on the host machine with the Vagrantfile) and then put the following command in your non-privileged provisioning block from the last advanced note: <code>ln -s /vagrant/.bashrc /home/vagrant/.bashrc</code>. This creates a soft link like you have already seen in <code>/bin</code> earlier.</p>
</div>
</div>
<h2><a class="header" href="#ignoring-files" id="ignoring-files">Ignoring files</a></h2>
<p>Compile your code with <code>gcc main.c -o program</code>, and check with <code>./program</code> that it runs and prints <em>Hi</em>. (If you get an error that <code>stdio.h</code> doesn't exist, then you have installed gcc but not <code>musl-dev</code> which is the package that contains the header files.)</p>
<p>If you look at <code>git status</code> now, the program file shows as untracked, but we do not want to commit it: the repository works best when you store only your source code, and anyone who needs to can check out a copy and build from there. Among other things this means that people on different platforms e.g. linux and mac, intel and ARM and so on can each compile the version that works for them.</p>
<p>So we want to tell git to ignore the program and changes in it, which we do by creating a file called <code>.gitignore</code> and adding an expression on each line to say which file(s) or folders to ignore - you can use <code>*.o</code> to select all object code files, for example.</p>
<ul>
<li>Create a file <code>.gitignore</code> and add the single line <code>program</code> to it.</li>
<li>Do another <code>git status</code> and notice that while the program is now ignored, the ignore file is marked as new. This file does belong in the repository, so add it and commit it.</li>
<li>Check that <code>git status</code> reports <em>clean</em> again, and that <code>git log</code> contains two commits.</li>
</ul>
<h2><a class="header" href="#commit-and-checkout" id="commit-and-checkout">Commit and checkout</a></h2>
<p>As you develop, you should regularly code, commit, repeat. To practice this, change <em>Hi</em> to <em>Hello</em> in the program, rebuild and run the program, then add and commit the source file again - check with <code>git status</code> at the end that you get <em>clean</em> again.</p>
<p>The command <code>git add .</code> adds all new and changed files and folders in the current folder in one go, and is typically the quickest way to add things when you want to commit all your changes since the last commit.</p>
<p>Sometimes you want to go back and look at another commit, or undo a commit that broke something - this is when you want a checkout.</p>
<ul>
<li>Use <code>git log</code> to show the history of your commits. (When you have more than one screen, <code>git log |less</code> lets you scroll.)</li>
<li>Note the first 6 or so characters of the commit hash of the commit where you added the ignore file, but before changing <em>Hi</em> to <em>Hello</em>. You need at least 6 characters, but only as many so that it's not ambiguous to git which commit you mean.</li>
<li>Run <code>git checkout HASH</code> where HASH is the 6 or however many you need characters of the commit in question. Git will print a warning about the HEAD pointer.</li>
<li>Check the source file, and notice that it is now back on <em>Hi</em>.</li>
<li>Use <code>git checkout master</code> to return to the latest version of your files, and git will set up the HEAD pointer again ready to accept new commits.</li>
</ul>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>If you actually want to undo a commit, then check out the previous one and run the following three commands:</p>
<pre><code>git stash
git checkout master
git stash pop
</code></pre>
<p>You can now make a new commit, as the files are back in the version of the commit that you checked out earler.</p>
<p>The stash is another feature of git, which works like a stack in that you can push and pop versions of your files on it. Here, we use it to stash away the old version that we want to reset the files to, then we checkout master to set git's internal pointers up to accept commits again, but this overwrites the files with the latest version - so we pop the stash to get back to the old ones.</p>
</div>
</div>
<h1><a class="header" href="#activity-2" id="activity-2">Activity 2</a></h1>
<h2><a class="header" href="#videos-1" id="videos-1">Videos</a></h2>
<h2><a class="header" href="#exercises-1" id="exercises-1">Exercises</a></h2>
<ul>
<li><a href="act2/git2.html">Git, part 2</a></li>
</ul>
<h1><a class="header" href="#git-part-2" id="git-part-2">Git, part 2</a></h1>
<p>In this exercise we will set up and use a git account on a remote provider. The &quot;big 3&quot; for hosting git repositories are:</p>
<ul>
<li><a href="https://github.com">github.com</a></li>
<li><a href="https://gitlab.com">gitlab.com</a></li>
<li><a href="https://bitbucket.org">bitbucket.org</a></li>
</ul>
<p>This exercise is based on github, as this is the most popular provider, but you can use one of the other two if you want as well (the slides show the equivalent version for gitlab) - although the web user interface and some advanced features are different, interacting with all three on the command line is identical and all three offer unlimited private and public repositories (within reason).</p>
<h2><a class="header" href="#set-things-up" id="set-things-up">Set things up</a></h2>
<p>Go to <a href="https://github.com">github.com</a> and register with a username, an e-mail address and a password. You might have to click a confirmation link in an e-mail sent to you.</p>
<p>We are going to use git over SSH, so you need to let git know your public key (remember, you never give anyone your private key!). Click the icon in the top right corner of the screen that represents your avatar (you can of course set a custom one if you like) and choose <em>Settings</em> in the menu, then on the settings page choose <em>SSH and GPG keys</em>.</p>
<p>Choose <em>New SSH key</em>, and paste your SSH public key in the <code>Key</code> box - this is the file <code>~/.ssh/id_ed25519.pub</code> that you created in the last activity. (The file <code>id_ed25519</code> without <code>.pub</code> in the same folder is your private key, and you never paste that anywhere.) Give your key a title if you like, then add it with the green button. Github supports all common SSH key formats, but will warn you if you do something silly like upload a private key or a key in an outdated and weak cipher.</p>
<div class="advanced">
<p>If you have many devices (desktop, laptop) that you work from and many servers (github, gitlab, lab machine etc.) that you connect to, how do you manage keys?</p>
<p>Using the same public key for different services is not a security problem: even if one service gets hacked and you connect to it while it's under the hacker's control, that does not leak your private key. Unlike passwords, you can safely reuse public keys.</p>
<p>However, reusing public keys can be a privacy problem, because every service that you use the same public key (or e-mail address, or phone number etc.) can potentially work with the others to know that you are the same individual. It is no problem to use different keypairs for different services, in which case you probably want a block in your <code>~/.ssh/config</code> file with something like </p>
<pre><code>Host github.com
    IdentityFile FILENAME
</code></pre>
<p>to tell SSH that the key for this host is named something other than the default <code>id_ed25519</code>.</p>
<p>You can copy the same private key to different devices that you own, or you can set up a different key for each device and add the public keys of all of them to github and the different providers. This is a security/convenience trade-off, the security angle being what happens if one of your devices gets stolen or otherwise compromised.</p>
<p>If you are running this exercise on an alpine VM hosted on a lab machine, then because the lab machine does not belong to you, I would not use the same private key on your VM than on your own computer, especially not if you use your own computer to access other services than the university. If you want to use Github both from your own machine and from the lab machines, then create a separate keypair for each and enrol both the public keys with Github.</p>
</div>
<p>I am assuming that you will be running the git commands in the rest of this section on an alpine linux VM, either on your machine or on a lab machine, however if you have git installed on your own machine directly (which is a good idea) then you can run this exercise there too.</p>
<h2><a class="header" href="#create-a-repository" id="create-a-repository">Create a repository</a></h2>
<p>On the main page, you should see an empty <em>Repositories</em> bar on the left, with a new button. Use that to create a repository, on the next page give it a name and tick the <em>Add a README file</em> box.</p>
<p>On the repository page, there is a green <em>Code</em> button. Clicking that opens a box with three tabs: <em>HTTPS</em>, <em>SSH</em> and <em>GitHub CLI</em>.</p>
<p>Each repository has a two-part name: the first part is the owner's github username, the second part is the repository name. For example, the repository for this unit is called <code>cs-uob/COMS10012</code>. There are two ways to interact with a remote repository:</p>
<ul>
<li>Via HTTPS. This is ok if you are just cloning a public repository, as it does not require any authentication. To interact with a private repository or to push files, HTTPS requires username/password authentication, and we can do better than that.</li>
<li>Via SSH, using keys. This is the recommended way to use Git.</li>
</ul>
<p>Click the SSH tab and copy the URL there - it should be something like <code>git@github.com:USERNAME/REPONAME.git</code>.</p>
<p>On the command line, run the command <code>git clone git@github.com:USERNAME/REPONAME.git</code> where you replace USERNAME and REPONAME with the parts from the SSH tab of your repository. Git clones your repository and puts the content in a subfolder named after the repository name - you can change this by providing a different folder name as an extra command-line argument to <code>git clone</code>, or you can just move or rename the folder later on.</p>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>Notice that git did not ask for your username. It can determine your identity from your public key, as that is stored in your user account.</p>
<p>In the last activity, we configured a name and e-mail address for git commits. When you push commits to github, this information will appear in every commit, but it does not have to match your Github account information - Github will let you push commits with any name you like, as you might be pushing them on behalf of someone else.</p>
</div>
</div>
<p>Go to that folder, and try <code>git remote show origin</code>. Here, <code>origin</code> is the default name of a <em>remote</em>, and the result should look a bit like this:</p>
<pre><code>* remote origin
  Fetch URL: git@github.com:USERNAME/REPONAME
  Push  URL: git@github.com:USERNAME/REPONAME
  HEAD branch: master
  Remote branch:
    master tracked
  Local branch configured for 'git pull':
    master merges with remote master
  Local ref configured for 'git push':
    master pushes to master (up to date)
</code></pre>
<p>The bits about <code>master</code> are to do with branches, which we will discuss in another activity.</p>
<div class="advanced container">
<header><span class="advanced-title"></span></header>
<div class="container-content">
<p>You can have several remotes with different names - for example if you fork (create your own copy of someone else's repository) then you get the original one as a second remote named <em>upstream</em>, so you can share changes back with them - this is the way you create new content for the <a href="https://cssbristol.co.uk">CSS website</a> for example.</p>
<p>You can also use folders as remotes: if you want to practice resolving merge conflicts, you could do the following:</p>
<pre><code>mkdir remote
cd remote
git init --bare
cd ..
mkdir user1
git clone remote user1
mkdir user2
git clone remote user2
</code></pre>
<p>This gets you a remote and two &quot;users&quot; in different folders to play with. The remote was set up with <code>--bare</code> so that it does not contain a working copy, but acts as a pure repository.</p>
<p>You can now <code>cd user1</code> to simulate user 1 doing work, and can fetch/push/pull as described below. (Ignore warnings about &quot;upstream&quot;, they will go away once you have committed a file to the repository.) Then you can <code>cd ../user2</code> to switch to a second working copy, which you can pretend is another user on another machine.</p>
<p>If you want to adjust the user names for the commits, then running <code>git config user.name &quot;YOURNAME&quot;</code> and <code>git config user.email &quot;YOUREMAIL&quot;</code> without the <code>--global</code> option from last time changes the settings just for one repository.</p>
</div>
</div>
<p>Do a <code>git status</code> and note that a new line appears compared to last activity:</p>
<pre><code>Your branch is up to date with 'origin/master'.
</code></pre>
<p>This line comes in four versions:</p>
<ul>
<li>Up to date: there have been no commits on your local or the remote repository since you last synchronised.</li>
<li>Ahead of remote: you have made commits locally that you have not yet pushed to the remote.</li>
<li>Behind remote: someone else, or you on a different computer, have made commits to the remote that you do not have on this computer yet.</li>
<li>Diverged from remote: both your computer and the remote have had different commits since the last time you synchronised. </li>
</ul>
<h2><a class="header" href="#practice-the-push-workflow" id="practice-the-push-workflow">Practice the push workflow</a></h2>
<p>For this exercise, you should work in pairs or larger groups.</p>
<p>One person creates a private repository (tick the box to add a README file) and adds everyone else in the group to it. You all need to have an account with the same provider for this to work.</p>
<ul>
<li>On Github, the way to add people to a repository is on the repository page: choose <em>Settings</em> in the top menu, then <em>Manage access</em>. Here you can press <em>Invite a collaborator</em> and enter their Github username. This causes Github to send them an e-mail with a link they need to click to accept the invitation and be added to the repository.</li>
<li>On Gitlab, the place to add people is under <em>Members</em> in the left menu on the repository page, and there are different access levels - give them  <em>Maintainer</em> access to let them push commits.</li>
</ul>
<p>Everyone <code>git clone</code>s the repository to their own alpine VM (or their own machine directly).</p>
<p>Everyone does the following, one person at a time doing all steps (coordinate among each other):</p>
<ol>
<li>Imagine that it is mid-morning and you are starting on a day's coding.</li>
<li>First, make sure your terminal is in the folder with your working copy, and type <code>git fetch</code>.
<ul>
<li>If you get no update, then there were no changes on the remote since your last fetch and you are ready to start coding. (This should happen to the first person to do this step.)</li>
<li>If you get output, then there were changes on the remote. Do a <code>git status</code> to see details (everyone except the first person should see this). Notice the line <code>behind origin/master ... can be fast-forwarded.</code> which means you just need to <code>git pull</code> and you will get the latest version of the files. Do a <code>git log</code> too to see the last person's commit message.</li>
</ul>
</li>
<li>Do some coding: make a change to the repository - add or change a file, then commit your changes. You can use <code>nano FILENAME</code> to create and edit a file in your terminal, if you have installed it as described in the last activity.</li>
<li>Run the following push workflow to push your changes to the remote:
<ol>
<li>Do a <code>git fetch</code> to see if there were any remote changes (there shouldn't be, for this exercise).</li>
<li>Do a <code>git status</code> and make sure you are <code>ahead of origin</code>, not <code>diverged</code>.</li>
<li>Do a <code>git push</code> to send your changes to the remote.</li>
</ol>
</li>
</ol>
<p>You can now code as a team, as long as only one person at a time is working - clearly not ideal.</p>
<h2><a class="header" href="#resolve-a-fake-conflict-part-one" id="resolve-a-fake-conflict-part-one">Resolve a fake conflict, part one</a></h2>
<p>Produce a &quot;fake&quot; conflict as follows:</p>
<ol>
<li>Two team members make sure they are <code>up to date</code> with their working copies (do a <code>git pull</code>, then <code>git status</code>). This represents you both starting coding in the morning.</li>
<li>One member adds or changes one file, then commits this change and pushes it by running the whole push workflow (fetch, status - check you're ahead, push).</li>
<li>At the same time as the first member is doing step 2, the second member adds or changes a different file, then commits this change. This represents two team members working in parallel, with the member one being the first one to complete their work and push a commit back to the remote.</li>
<li>The second member starts the push workflow with <code>git fetch</code>, then <code>git status</code>. Notice you have <code>diverged</code>. (If you were to try to <code>git push</code>, with or without fetching this would produce an error.)</li>
</ol>
<p>The commit graph of member two looks something like this:</p>
<p><img src="act2/../resources/before-rebase.png" alt="diagram of commits before rebase" /></p>
<p>One way to resolve this conflict is a <em>rebase</em>, which is pretending that member two had actually fetched the <code>one</code> commit before starting their own work. The command for this which member two types is <code>git rebase origin/master</code> which means <em>pretend that everything in origin/master happened before I started my local changes</em> and gives the following graph:</p>
<p><img src="act2/../resources/after-rebase.png" alt="diagram of commits after rebase" /></p>
<p>Indeed, if member two does a <code>git status</code> after the rebase, they will see <code>ahead of origin/master by 1 commit</code> and they can now <code>git push</code> to send their local changes to the remote repository.</p>
<p>Different companies and teams have different opinions on when a rebase makes sense: some places forbid rebasing like this entirely, at least for work that is genuninely shared between different people. There is more or less a general consensus that you should not rebase when different people were editing the same files, but it is a technique worth knowing about for conflicts like the one you just created where different people have edited different files, as it makes for a cleaner commit graph.</p>
<h2><a class="header" href="#fake-conflicts-part-two" id="fake-conflicts-part-two">Fake conflicts, part two</a></h2>
<p>The other way to fix conflicts - and the only one that some people will use - is a merge. Let's do another fake conflict, but resolve it with a merge this time:</p>
<ol>
<li>Two team members both get their repositories up to date with the remote. If you have just followed the instructions above then team member one has to <code>git pull</code> and team member two is already up to date because they have just pushed; both team members should check with <code>git fetch</code> then <code>git status</code> that they are <code>up to date</code>.</li>
<li>Like before, team member one edits one file, commits it and does the whole push workflow (fetch, status - check you're ahead, push). The second team member at the same time, without another fetch, edits a different file and commits.</li>
<li>The second team member starts the push workflow: fetch, status - notice you've <code>diverged</code>.</li>
</ol>
<p>The second member's commit graph looks similar to the previous one before the rebase, perhaps with more commits in place of the <em>initial</em> one.</p>
<p>The second member is about to do a merge, which can either succeed (as it would have in the previous example, because different people edited different files) or fail with a merge conflict (as it will do in this case). If a merge succeeds, then git will make a merge commit and will drop them into their system's default editor, which is normally <code>vi</code>. Because we don't want to learn that right now, the second member should type <code>echo $EDITOR</code> in their shell and see what they get - if they get <code>nano</code> then they're fine, if they get an empty line then they should do <code>export EDITOR=nano</code>.</p>
<p>The second team member types <code>git pull</code>. Since this is a fake conflict (different files), this gets you into your editor, and you can see that on the first line is a suggested commit message starting with <code>Merge branch master</code>, which it is conventional to accept without changes - exit your editor again. Git replies <code>Merge made by the recursive strategy.</code> and your commit graph now looks something like this (the <code>...</code> stands for the last commit from the previous section):</p>
<p><img src="act2/../resources/after-merge.png" alt="diagram of commits after merge" /></p>
<h2><a class="header" href="#resolving-a-real-conflict" id="resolving-a-real-conflict">Resolving a real conflict</a></h2>
<p>And next, we'll practice dealing with a real conflict, where two people have edited the same file.</p>
<ol>
<li>Two team members get their repositories synchronised again: everyone does a <code>git pull</code>.</li>
<li>Team member one creates a file called <code>README.md</code> or edits it if it already exists, and adds a line like <code>Created by NAME</code> with their own name. Then they commit this change and run the push workflow: <code>git fetch</code>, <code>git status</code>, check they're <code>ahead</code>, <code>git push</code> to the remote.</li>
<li>Team member two, without fetching the latest commit, creates the same <code>README.md</code> file and adds a line <code>Created by NAME2</code> and commits this to their local repository. This simulates two people working on the same files in parallel since they both last fetched, and one of them (member one in this case) is the first to get their changes back to the remote.</li>
<li>Team member two starts the push workflow: <code>git fetch</code>, <code>git status</code> and notice that you have <code>diverged</code> again.</li>
<li>Run <code>git pull</code> as member two. You should see the following message:</li>
</ol>
<pre><code>CONFLICT (add/add): Merge conflict in README.md
Auto-merging README.md
Automatic merge failed; fix conflicts and then commit the result.
</code></pre>
<p>Open the file, for example <code>nano README.md</code> and notice that git has annotated it:</p>
<pre><code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
Created by NAME2.
=======
Created by NAME1.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; b955a75c7ca584ccf0c0bddccbcde46f445a7b30
</code></pre>
<p>The lines between <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</code> and <code>=======</code> are the local changes (team member two) and the ones from <code>======</code> to <code>&gt;&gt;&gt;&gt;&gt;&gt; ...</code> are the ones in the commit fetched from the remote, for which the commit id is shown.</p>
<p>Member two now has to resolve the conflict by editing the file to produce the version they would like to commit. For example, you could remove all the offending lines and replace them with <code>Created by NAME1 and NAME2.</code></p>
<p>Member two can now do the following:</p>
<ul>
<li><code>git add README.md</code> (or whatever other files were affected).</li>
<li><code>git commit</code>. You could give a message directly, but a commit without a <code>-m</code> drops you into your editor and you'll see that git is suggesting <code>Merge branch master ...</code> as a default message here. It is conventional to leave this message as it is, just exit your editor without any changes.</li>
<li>Run another push workflow: <code>git fetch</code>, <code>git status</code> and notice you are now <code>ahead by 2 commits</code>: the first one was the work you did, the second is the merge commit. You're ahead, so finish the workflow with <code>git push</code>.</li>
</ul>
<p>Your commit graph looks the same as for the last merge that you did. </p>
<p>If you look at the repository's page on Github (<code>https://github.com/USERNAME/REPONAME</code>, where <code>USERNAME</code> is the name of the user who created the repository), then you can click on <em>Insights</em> in the top bar then <em>Network</em> on the left menu to see the commit history for the repository as a graph. Hovering over a commit node shows the committer, the message and the commit hash - and clicking on a node takes you to a page where you can see which changes were made in this commit.</p>
<p>On the main Github page for the repository, you can also click the clock icon with a number in the top right (on a wide enough screen it also shows the word <em>commits</em>) to go to a page showing all the commits on your repository in chronological order.</p>
<h1><a class="header" href="#activity-3" id="activity-3">Activity 3</a></h1>
<h1><a class="header" href="#activity-4" id="activity-4">Activity 4</a></h1>
<h1><a class="header" href="#inputoutput-in-c" id="inputoutput-in-c">Input/Output in C</a></h1>
<h2><a class="header" href="#reminder-c-file-handling" id="reminder-c-file-handling">Reminder: C file handling</a></h2>
<p>You should already be familiar with the following C functions from <code>&lt;stdio.h&gt;</code>, though you can look up details with <code>man 3 FUNCNAME</code> on a lab machine:</p>
<ul>
<li><code>FILE *fopen(const char *path, const char *mode)</code> opens a file, returning a file handle if successful and NULL otherwise. On some systems, it makes a difference whether you read a file in text mode (<code>r</code>) or binary mode (<code>rb</code>), the difference being that the former activates an extra &quot;line discipline&quot; in the C library. For example on Windows, text mode translates a lone <code>\n</code> character to <code>\r\n</code>. <em>On POSIX systems, there is no difference between text and binary mode.</em> </li>
<li><code>int fclose(FILE *file)</code> closes a file, and flushes any pending writes. It returns 0 on success and nonzero in case of errors.</li>
<li><code>int fflush(FILE *file)</code> flushes a file: for output, it makes sure any buffered characters are written out. For input, it throws away any unread input in the c library input buffer. It returns 0 on success and nonzero in case of errors. <code>fflush(NULL)</code> flushes all open files.</li>
<li><code>int feof(FILE *file)</code> returns nonzero if the file in question has reached end-of-file, and zero otherwise. This is the only correct way to test for an end-of file condition.</li>
<li><code>int ferror(FILE *file)</code> returns nonzero if the file in question is in an error state. For example after a <code>fread</code> that did not return the expected number of blocks, exactly one of <code>feof</code> and <code>ferror</code> will return nonzero, indicating what happened. In case of an error, the global variable <code>errno</code> will contain the error code.</li>
<li><code>size_t fread(void *dest, size_t size, size_t num, FILE *file)</code> reads up to <code>num</code> blocks of <code>size</code> bytes into the buffer at <code>dest</code> and returns the number of blocks read (for a block size of 1, this is the number of bytes). If the return value is less than <code>num</code> then either an error occurred or the end of the file was reached.</li>
<li><code>size_t fwrite(const void *buffer, size_t size, size_t num, FILE *file)</code> writes up to <code>num</code> blocks of <code>size</code> bytes from the <code>buffer</code> to the <code>file</code> and returns the number of blocks written. If this is less than <code>num</code>, then an error occurred during the writing.</li>
</ul>
<p>A number of utility functions build upon these:</p>
<ul>
<li><code>int fprintf(FILE *stream, const char *format, ...)</code> writes formatted output to a file, usually by calling <code>fwrite</code> behind the scenes. <code>printf</code> is a shortcut for <code>fprintf(stdout, ...)</code>. These functions to not print a newline unless you ask for one. It returns the number of characters written, or a negative number if an error occurred.</li>
<li><code>int fputs(const char *string, FILE *file)</code> writes a zero-terminated string to the file, not including the zero terminator. <code>puts</code> is a shortcut that writes to <code>stdout</code> <em>and</em> adds a newline at the end. </li>
<li><code>int fputc(int c, FILE *file)</code> writes a single character (<code>c</code> is cast to an <code>unsigned char</code> first) and <code>putchar</code> is a shortcut for writing to <code>stdout</code> (but does not add a newline, unlike <code>puts</code>).</li>
<li><code>int fgetc(FILE *file)</code> reads a single character from a file (but returns it as an int, however it's safe to cast to char). <code>getchar</code> is a shortcut that reads from standard input.</li>
<li><code>char *fgets(char *buffer, int size, FILE *file)</code> reads up to <code>size-1</code> bytes into the buffer, stopping early if it finds a null byte, newline or end-of-file character. It then adds a zero-terminator to the string. If it stopped early because of a newline, the newline is included in the buffer; if it stopped due to an end-of-file then this is not included. Older versions of C included a <code>gets</code> version that reads from standard input and does not take a size argument; this is insecure as it can produce a buffer overflow and it should never be used. <code>fgets</code> is safe if the length of the buffer is at least <code>size</code> bytes. It returns a pointer to buffer on success and NULL if an error occurred. End-of-file counts as an error for this purpose if no characters could be read at all.</li>
</ul>
<p>Fread (and fwrite) can return in one of three different states:</p>
<ol>
<li>The return value is equal to the number of items you asked to read/write (third argument). This means that the read/write was successful.</li>
<li>The return value is not equal to the number of items, <code>ferror</code> returns nonzero on the file: an error occurred. The return value indicates how many items were successfully read or written before the error occurred. <code>errno</code> contains more information about what happened.</li>
<li>The return value is not equal to the number of items, <code>ferror</code> returns zero on the file: end of file. Calling <code>feof</code> on the file will return nonzero. End of file when reading means exactly what it says; end of file when writing to something with a program on the other side (pipe, socket, pty) means the other side has closed the connection.</li>
</ol>
<h2><a class="header" href="#exercises-2" id="exercises-2">Exercises</a></h2>
<p>For our first exercise, we investigate how the C library file functions interact with the terminal. Compile this program:</p>
<pre><code class="language-C">// program: input1.c //
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;

// Utility function to print an error message and return from main,
// use: return error(code, text); // in main
// prints text and the current errno value, then returns code.
int error(int ret, char* text) {
  int e = errno;
  printf(&quot;Error %s: %s (code %i).\n&quot;, text, strerror(e), e);
  return ret;
}

int main(int argc, char **argv) {
    if (argc &lt; 2) { printf(&quot;Use: %s FILENAME\n&quot;, argv[0]); return 1; }
    printf(&quot;Opening [%s]\n&quot;, argv[1]);
    FILE *file = fopen(argv[1], &quot;r&quot;);
    if (file == NULL) { return error(2, &quot;opening file&quot;); }
    
    char c, d;
    size_t result = fread(&amp;c, 1, 1, file);
    if (result &lt; 1) { 
      if (ferror(file)) {
        return error(2, &quot;reading first character&quot;);
      } else {
        puts(&quot;No first character - end of file?&quot;);
        return 2;
      }
    }
    printf(&quot;Read character: [%c].\n&quot;, c);
    result = fread(&amp;d, 1, 1, file);
    if (result &lt; 1) { 
      if (ferror(file)) {
        return error(2, &quot;reading second character&quot;); 
      } else {
        puts(&quot;No second character - end of file?&quot;);
        return 2;
      }
    }
    printf(&quot;Read another character: [%c].\n&quot;, d);
    
    int e = fclose(file);
    if (e) { return error(2, &quot;closing file.&quot;); }
    return 0;
}
</code></pre>
<p>The essence of the program are the four lines</p>
<pre><code>fread(&amp;c, 1, 1, file);
printf(..., c);
fread(&amp;d, 1, 1, file);
printf(..., d);
</code></pre>
<p>which read two characters from the file indicated in its first argument, then print them out.
Note that we print the first character before reading the second, as this will become relevant.</p>
<p>The rest of the program is error handilng, and although some tutorials leave this off to make the code look easier, this sets you up for terrible habits - in the real world, errors happen and you need to handle them properly. So this program also shows the absolute minimum of error handling when you work with a file.</p>
<ul>
<li>Make a file <code>file</code> containing some characters such as <code>abc</code> and run <code>./input1 file</code>. Convince yourself that the program prints the first two characters (first two bytes, to be precise).</li>
<li>Next, run <code>./input1 /dev/stdin</code>, to make it read from standard input. Notice that it blocks.
Type a few characters such as <code>abc</code> and notice that the program prints nothing, until you press ENTER at which point both the &quot;Read character&quot; and &quot;Read another character&quot; output appears at once. <strong>What is the reason for this?</strong></li>
<li>Restart the program, and when it is waiting for input, type <code>ab[BACKSPACE]c[ENTER]</code>. <strong>Explain what you see.</strong> </li>
<li>What happens if you enter only one character and then press ENTER? What if you press ENTER and haven't typed anything at all?</li>
<li>If you want, verify that using fgetc / getchar produces the same behaviour on standard input: the program does not proceed past the first read command until you press ENTER. You can even try debugging with gdb to make sure.</li>
<li>Insert the line <code>setbuf(file, NULL);</code> just after the <code>fopen</code> line to make sure it's not the C library buffering.</li>
</ul>
<p>Have you answered the questions in bold above before reading on?</p>
<ul>
<li>Next, on your terminal, execute <code>stty -icanon</code>, which turns off the &quot;icanon&quot; setting. (The convention for <code>stty</code> is that an option name in an argument turns it on, except if prefixed with a minus which turns it off.)</li>
<li>Rerun the program (<code>./input1 /dev/stdin</code>) and see what happens now.</li>
<li>Turn &quot;icanon&quot; back on with <code>stty icanon</code>. </li>
<li>Research what <code>icanon</code> does, for example in <code>man stty</code> on a lab machine (the alpine version of the manual is less helpful) or online.</li>
<li><strong>Why does BACKSPACE and <code>^U</code> work in your bash shell, even with icanon turned off?</strong></li>
</ul>
<p>Next, we are going to experiment with the terminal in fully raw mode:</p>
<ul>
<li><code>stty -g</code> prints the current terminal setting in a format that you can save and load again. Take a look, then store them with the shell command <code>state=$(stty -g)</code>.</li>
<li>Execute <code>stty raw</code>, then run your program again. <strong>The terminal looks a bit &quot;messed up&quot; - can you tell what is happening?</strong> Try another command like <code>ls</code> in raw mode too it that helps.</li>
<li>Restore your terminal settings with <code>stty $state</code>, reading them back from the variable where you stored them. You can then reset the window with <code>^L</code>.</li>
</ul>
<p>There is an important warning here if you are ever benchmarking a program that produces (standard) output - the total running time will be the sum of the program's running time and the connected terminal's running time to process the output. For example, printing a sequence of newline characters is typically slower than printing a sequence of 'a's, even if both programs are doing <code>putc</code> in a loop, because the terminal has extra work to do on each newline.</p>
<p>Here is another C program to experiment with:</p>
<pre><code class="language-C">// input2.c //
// Reads characters in a loop and prints their hex codes. 
// Quit with 'Q'.

#include &lt;stdio.h&gt;

int main() {
  unsigned char c;
  int r;
  setbuf(stdout, NULL);
  while(1) {
    r = fread(&amp;c, 1, 1, stdin);
    if (r &lt; 1) break; // bail out on error or eof
    if (c == 'Q') break;
    printf(&quot;(%02X) &quot;, c);
  }
  return 0;
}
</code></pre>
<ul>
<li>What do you expect to happen if you run this in a &quot;normal&quot; terminal and type a few characters?</li>
<li>Run it in a terminal with icanon turned off and type a few characters. Notice that you can still cancel it with <code>^C</code>.</li>
<li>Run it in a terminal in raw mode and type a few characters. What happens now when you press <code>^C</code>?</li>
</ul>
<p>Luckily, we built in another way to quit the program with Q!</p>
<ul>
<li>In raw mode, try a few &quot;special&quot; keys such as ENTER, ESC, the arrow keys, function keys (F1, F2) etc.</li>
<li>We turned off buffering for standard <em>output</em>. Why is this important - what happens otherwise and who is doing the buffering?</li>
</ul>
<p>What actually happens when you press Control-C in a terminal in &quot;cooked&quot; mode is it sends the signal <code>SIGINT</code> (interrupt) to the connected program - the default behaviour for this signal is to terminate the program. Putting the terminal in raw mode just passes the control code for Control-C on to the program, though it would still quit if you sent it a SIGINT another way (e.g. with the <code>kill</code> command from another terminal). However, you could also write a signal handler in your own program that reacts to SIGINT and does something else, for example just ignores the signal.</p>
<p>When you type say an <code>a</code>, even in raw mode, the character appears on your screen even though there's no print command for it. This is the terminal echo; you can turn even this off with <code>stty -echo</code> but you are now typing blind! You can still start your program with <code>./input2</code> followed by ENTER, and it will still print the hex codes of everything you type from then on until you press Q but it will no longer show you the characters themselves. If you saved the terminal state before, then typing <code>stty $state</code> and ENTER will get you your echo back.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
